flowchart TD
  %% User side
  subgraph UserSide
<<<<<<< HEAD
    U[User / Client<br/>(csv path, n_insights)]
=======
    U["User / Client (csv path, n_insights)"]
>>>>>>> 3d6941dba47f10798e09367a8a993f1a43503938
  end

  %% Orchestrator
  subgraph Orchestrator
    RA["ReportAgent"]
  end

  %% Analysis subsystem
  subgraph Analysis["Analysis Subsystem"]
    DA["DataAnalystAgent (AssistantAgent + LLM)"]
    CSVT["CSV Tools (preview, summarize, correlations, generate_insights)"]
  end

  %% Visualization
  subgraph Visualization["Visualization Subsystem"]
    VIZ["Viz Tools (hist, heatmap, scatter, top_corrs)"]
  end

  %% Evaluation
  subgraph Evaluation["Evaluation Subsystem"]
    EV["EvaluatorAgent (AssistantAgent)"]
  end

  AA["AssistantAgent (Executive Summary / Polish)"]
  STORE["Storage (.md, .html, plots/)"]

  %% Main flows
  U -->|1. submit CSV| RA
  RA -->|2. request analysis (prompt)| DA
  DA -->|3. call tools| CSVT
  CSVT -->|4. numeric_summary / corrs| DA
  DA -->|5. insights_text| RA

  RA -->|6. request visuals| VIZ
  VIZ -->|7. plot files| RA

  RA -->|8. evaluate insights| EV
  EV -->|9. evaluation JSON| RA

  RA -->|10. generate exec summary (optional)| AA
  AA -->|11. exec_summary| RA

  RA -->|12. save report & visuals| STORE
  STORE -->|13. report path| U

  classDef llm fill:#fff2cc,stroke:#b87300;
  class DA,EV,AA llm
